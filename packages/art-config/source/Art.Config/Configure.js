"use strict"
let Caf = require('caffeine-script-runtime');
Caf.defMod(module, () => {return Caf.importInvoke(["deepMerge", "getExternalEnvironment", "getArtConfig", "getDefaultArtConfigName", "normalizeArtConfigName", "ConfigRegistry", "log", "setArtConfigName", "compactFlatten", "expandPathedProperties", "getArtConfigName", "Object"], [global, require('art-standard-lib'), require('./Lib'), require('./PublicLib'), {ConfigRegistry: require('./ConfigRegistry')}], (deepMerge, getExternalEnvironment, getArtConfig, getDefaultArtConfigName, normalizeArtConfigName, ConfigRegistry, log, setArtConfigName, compactFlatten, expandPathedProperties, getArtConfigName, Object) => {let Configure; return Configure = Caf.defClass(class Configure extends Object {}, function(Configure, classSuper, instanceSuper) {this._lastConfigurationOptions = null; this.configure = (...configureOptions) => {let artConfigNameArgument, artConfigArgument, __testEnv, onConfig, externalEnvironment, config, defaultArtConfigName, configName, verbose, base; ({artConfigName: artConfigNameArgument, artConfig: artConfigArgument, __testEnv, onConfig} = this._lastConfigurationOptions = deepMerge(...configureOptions)); externalEnvironment = getExternalEnvironment(__testEnv); config = getArtConfig(); defaultArtConfigName = getDefaultArtConfigName(); configName = normalizeArtConfigName(externalEnvironment.artConfigName || artConfigNameArgument || global.artConfigName) ? (configName = normalizeArtConfigName(externalEnvironment.artConfigName || artConfigNameArgument || global.artConfigName), (configName && !ConfigRegistry.configs[configName] && configName !== "Test") ? log.warn(`ArtConfig.configure: no config registered with name: '${Caf.toString(configName)}-'`) : undefined, configName) : defaultArtConfigName; setArtConfigName(configName); this._eraseAllConfiguration(); Caf.each2(compactFlatten([Caf.array(ConfigRegistry.configurables, (configurable) => configurable.getPathedDefaultConfig()), ConfigRegistry.configs[configName], global.artConfig, artConfigArgument, externalEnvironment.artConfig]), (conf) => expandPathedProperties(conf, config)); ({verbose} = config); verbose || (verbose = Caf.exists(base = this._lastConfigurationOptions) && base.verbose); if (verbose) {log("------------- ArtConfig.configure: inputs"); log({"ArtConfig.configure": this.getVerboseConfigurationInfo()}); log("------------- ArtConfig.configure: configuring Configurables...");}; this._configureAllConfigurables(); if (verbose) {log("------------- ArtConfig.configure: configured"); log({Art: {configName, config}}); log("------------- ArtConfig.configure: done");}; Caf.isF(onConfig) && onConfig(config); return config;}; this.getVerboseConfigurationInfo = function() {let configOptions, externalEnvironment, configName; configOptions = this._lastConfigurationOptions; externalEnvironment = getExternalEnvironment(configOptions.__testEnv); configName = getArtConfigName(); return {configNames: Object.keys(ConfigRegistry.configs), configurables: Caf.array(ConfigRegistry.configurables, (c) => c.namespacePath), setConfigName: {algorithm: "select LAST non-null", inputs: {defaultArtConfigName: getDefaultArtConfigName(), "global.artConfigName": global.artConfigName, "arguments.artConfigName": configOptions.artConfigName, "environment.artConfigName": externalEnvironment.artConfigName}}, setConfig: {algorithm: "deep, pathed merge-all, LAST has priority", inputs: {defaultConfigs: Caf.array(ConfigRegistry.configurables, (configurable) => configurable.getPathedDefaultConfig()), [`configs.${Caf.toString(configName)}`]: ConfigRegistry.configs[configName], "global.artConfig": global.artConfig, "arguments.artConfig": configOptions.artConfig, "environment.artConfig": externalEnvironment.artConfig}}};}; this.resetCurrentConfig = () => {log.warn("DEPRICATED: resetCurrentConfig will be removed; call 'configure'"); return this._eraseAllConfiguration();}; this.reload = () => {log.warn("DEPRICATED: reload will be removed; call 'configure'"); return this._reconfigure();}; this._reconfigure = () => this.configure(this._lastConfigurationOptions); this._eraseAllConfiguration = () => {let config; return Caf.each2(config = getArtConfig(), (v, k) => delete config[k]);}; this._configureAllConfigurables = function() {Caf.each2(ConfigRegistry.configurables, (configurable) => configurable.configure(getArtConfig())); return this._notifyConfigurablesConfigured();}; this._notifyConfigurablesConfigured = function() {return Caf.each2(ConfigRegistry.configurables, (configurable) => configurable.configured());};});});});
//# sourceMappingURL=Configure.js.map
