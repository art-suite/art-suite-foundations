"use strict"
let Caf = require('caffeine-script-runtime');
Caf.defMod(module, () => {return Caf.importInvoke(["allPackageExec", "merge", "compactFlattenAll", "cleanMonorepo", "green"], [global, require('./StandardImport')], (allPackageExec, merge, compactFlattenAll, cleanMonorepo, green) => {let makeNpmRunCommand, makeNpmCommand; makeNpmRunCommand = function(command) {return (options, args) => allPackageExec(merge(options, {skip: ({scripts}, path) => !((Caf.exists(scripts) && scripts[command]) != null) ? `(package.json does not have a '${Caf.toString(command)}' script)` : undefined, folder: compactFlattenAll(options.folder, args), command: `npm run ${Caf.toString(command)}`, verb: command}));}; makeNpmCommand = function(command) {return {options: {verbose: "true/false", folder: 'find all packages in this path. default: "."', sync: "true/false - if true, run each command in order, waiting for each to finish before running the next."}, args: "Find all packages in any additional paths passed as args.", description: `Runs \`npm run ${Caf.toString(command)}\` in every subfolder with a package.json file.`, run: makeNpmRunCommand(command)};}; return {test: makeNpmCommand("test"), build: makeNpmCommand("build"), sync: {description: 'Syncs the root package.json with all sub-packages. Ensures:\n\n- All sub-packages use the same version of each external dependency.\n- All internal cross-package references are updated to the latest version and linked to use the local packages instead of published npm versions.\n- The root package.json includes all external dependencies used in sub-packages.\n\nRun npm install immediately after running this command.\n\nSync is done in three Steps:\n\n1. Clean: Removes all package-lock.json files and node_modules folders in sub-packages. The root should be the only place with a lockfile and installed modules.\n2. Update sub-packages: Aligns all sub-package dependency versions with each other and the root.\n3. Update root: Merges in any new or updated dependencies from sub-packages and ensures all cross-package dependencies use the "file:..." npm protocol.\n\nAbout the preserveRootDependencies option:\n\nBy default, the root package.json is treated as a monorepo manager onlyâ€”not an active code package. Its dependencies field is fully regenerated to represent the union of all sub-package dependencies and devDependencies. Its devDependencies field is untouched (reserved for monorepo tools like art-monorepo). Any root dependency not used in a sub-package will be removed.\n\nIf the root is also used for coding, use the preserveRootDependencies option. This prevents pruning of root dependencies. Instead, the tool merges sub-package dependencies into the root. You are responsible for removing obsolete dependencies manually.', options: {quiet: "Suppress output.", preserveRootDependencies: "Don't remove dependencies from the root package.json even if they are not found in any sub-packages. See the full command description for more details."}, run: function(options) {return cleanMonorepo().then(() => require('./UpdateSubPackages').run(options)).then(() => require('./UpdateMonoPackage').run(options)).then(() => green("All package.json files synced."));}}, run: {description: "'npm run X' in all packages. This will run the command in every subfolder with a package.json file.", options: {verbose: "true/false", folder: 'find all packages in this path. default: "."', sync: "true/false - if true, run each command in order, waiting for each to finish before running the next."}, args: {description: "Npm run-command.", argument: "npm-script"}, run: function(options, args) {return makeNpmRunCommand(args[0])(options, args.slice(1));}}, exec: {description: "Run shell command in every subfolder with a package.json file.", options: {verbose: "true/false", folder: 'find all packages in this path. default: "."', sync: "true/false - if true, run each command in order, waiting for each to finish before running the next."}, args: {description: "Shell command to run.", argument: "command"}, run: function(options, args) {return allPackageExec(merge(options, {verb: "exec", command: args.join(" ")}));}}, versions: require('./versions'), clean: {description: "Advanced: Delete all package-lock.json files and node_modules folders in all subfolders. There should only be one package-lock.json file and one node_modules folder located in the root of the monorepo.", run: function(options) {return cleanMonorepo().then(() => green("Monorepo is clean."));}}};});});
//# sourceMappingURL=Commands.js.map
